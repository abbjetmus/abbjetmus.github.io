import{a8 as M,r as C,t as O,k as n,ai as u,ac as o,aj as z,n as i,ab as l,al as v,ag as _,u as r,ae as S,l as y,m as A,F as G,ah as H,p as I,ad as J,af as K}from"./index.ae99ad44.js";import{Q as W}from"./QItemLabel.69499165.js";import{Q as X,a as $}from"./QItem.4a94c215.js";import{Q as Y}from"./QList.10a153e4.js";import{u as Z,Q as ee}from"./useAuthValidations.a8b861ea.js";import{Q as ae}from"./QPage.19f16d6a.js";import{u as te}from"./position-engine.8177d215.js";import{_ as se}from"./ImagesDialog.ce6e48e6.js";import{E as le}from"./style.f3f92b51.js";import{b as oe,s as Q,d as m,a as ie,e as U,c as ne,y as re,p as de,g as ue}from"./auth.da776fb7.js";import{v as me}from"./v4.c4aae7a6.js";import"./selection.dacc8383.js";import"./QTooltip.76f93be4.js";import"./ClosePopup.f83d1bdb.js";import"./QMenu.46e28889.js";const ce={class:"row q-col-gutter-md"},pe={class:"col-3"},fe={class:"row justify-between q-mb-md"},ve=i("div",{class:"text-h5 q-mr-lg"},"Slides",-1),_e={class:"q-my-md"},ye={key:1,class:"text-center"},ge={class:"col-9 row justify-center"},he={class:"full-width full-height"},we={class:"row justify-between q-mb-md"},be={class:"col-auto"},ke={key:0},Se={key:1},Re=M({__name:"CreatePresentationPage",setup(Qe){const g=te(),d=z(),{form:h,validInputs:c,loading:V}=Z(),w=C(!1),a=C(null),N=oe(Q(m,"presentations",`${d.params.id}`)),q=ie(U(m,"presentations",`${d.params.id}`,"slides")),B=()=>{c.value=!1,h.value!=null&&h.value.validate().then(async e=>{if(e)if(V.value=!0,c.value=!0,b.value){let t=await D(a.value);a.value.id=t.id,g.notify({color:"success",position:"bottom",message:"Sliden har lagts till!"})}else await L(a.value),g.notify({color:"success",position:"bottom",message:"Sliden har uppdaterats!"});else c.value=!1;V.value=!1}).catch(e=>{c.value=!1})},b=O(()=>{var e;return((e=a.value)==null?void 0:e.id)==null}),P=e=>{a.value=e},F=()=>{a.value={title:"",content:"Ny slide",time:5}},j=async()=>{a.value!=null&&(await R(a.value.id),g.notify({color:"success",position:"bottom",message:"Sliden har tagits bort!"}),a.value=null)},E=async(e,t)=>{const p=await Promise.all(e.map(s=>new Promise((f,x)=>{const T=me();ne(s,"images",T).then(k=>f(k)).catch(k=>x(k))})));t(p.map(s=>s))},D=async e=>await de(U(m,"presentations",`${d.params.id}`,"slides"),e),L=async e=>{var t;await ue(Q(m,"presentations",`${d.params.id}`,"slides",(t=e.id)!=null?t:""),{title:e.title,content:e.content,time:e.time})},R=async e=>{await re(Q(m,"presentations",`${d.params.id}`,"slides",e))};return(e,t)=>(n(),u(ae,{class:"q-pa-md"},{default:o(()=>{var p;return[i("div",ce,[i("div",pe,[i("div",fe,[ve,l(_,{color:"primary",unelevated:"",class:"col",onClick:F},{default:o(()=>[v("Ny Slide ")]),_:1})]),i("div",_e,[l(S,{outlined:"","model-value":(p=r(N))==null?void 0:p.name,label:"Presentationens namn",readonly:""},null,8,["model-value"])]),r(q).length>0?(n(),u(Y,{key:0,bordered:"",separator:"",clickable:""},{default:o(()=>[(n(!0),y(G,null,A(r(q),s=>{var f;return n(),u(X,{class:"q-py-md",clickable:"",key:s.id,active:((f=a.value)==null?void 0:f.id)==s.id,onClick:x=>P(s)},{default:o(()=>[l($,null,{default:o(()=>[l(W,{lines:"2"},{default:o(()=>[v(J(s.title),1)]),_:2},1024)]),_:2},1024),l($,{side:""},{default:o(()=>[l(K,{name:"chevron_right"})]),_:1})]),_:2},1032,["active","onClick"])}),128))]),_:1})):(n(),y("div",ye,"Inga slides har lagts till \xE4n"))]),i("div",ge,[i("div",he,[a.value?(n(),u(ee,{key:0,ref_key:"form",ref:h,onSubmit:H(B,["prevent"]),greedy:""},{default:o(()=>[i("div",we,[i("div",be,[l(_,{color:"green-5",style:{width:"200px"},type:"submit"},{default:o(()=>[r(b)?(n(),y("span",ke,"Skapa")):(n(),y("span",Se,"Uppdatera"))]),_:1}),l(_,{class:"q-ml-md",style:{width:"200px"},color:"primary",onClick:t[0]||(t[0]=s=>w.value=!0)},{default:o(()=>[v("Bilder ")]),_:1})]),r(b)?I("",!0):(n(),u(_,{key:0,color:"red",style:{width:"200px"},class:"col-auto",onClick:j},{default:o(()=>[v("Radera")]),_:1}))]),l(S,{label:"Titel",modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),outlined:"",required:"",class:"q-mb-md"},null,8,["modelValue"]),l(S,{label:"Visningstid f\xF6r sliden",modelValue:a.value.time,"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.time=s),outlined:"",required:"",type:"number",class:"q-mb-lg"},null,8,["modelValue"]),i("div",null,[l(r(le),{modelValue:a.value.content,"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.content=s),language:"en-US",onOnUploadImg:E},null,8,["modelValue"])])]),_:1},8,["onSubmit"])):I("",!0)])])]),l(se,{show:w.value,"onUpdate:show":t[4]||(t[4]=s=>w.value=s)},null,8,["show"])]}),_:1}))}});export{Re as default};
