import{r as z,t as d,g as $,N as Y,Q as L,I as G,v as x,q as H,b3 as J,b8 as Z,b4 as ee,b6 as te,b9 as ae,bk as le,ba as U,bl as ne,b5 as ie,M as ue,a8 as re,k as se,ai as oe,ac as E,aa as ce,n as M,al as de,ab as V,bm as fe,ag as me,aL as ve}from"./index.ae99ad44.js";import{Q as ge}from"./QChip.e62993a1.js";import{h as pe}from"./format.2a3572e1.js";import{Q as be}from"./QPage.19f16d6a.js";import{_ as he,v as Fe}from"./v4.c4aae7a6.js";import{c as xe}from"./auth.da776fb7.js";import"./QItem.4a94c215.js";import"./QList.10a153e4.js";import"./QMenu.46e28889.js";import"./position-engine.8177d215.js";import"./selection.dacc8383.js";import"./ClosePopup.f83d1bdb.js";function _(e,r,h,b){const i=[];return e.forEach(s=>{b(s)===!0?i.push(s):r.push({failedPropValidation:h,file:s})}),i}function q(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),L(e)}const ye={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},_e=["rejected"];function Se({editable:e,dnd:r,getFileInput:h,addFilesToQueue:b}){const{props:i,emit:s,proxy:g}=$(),f=z(null),y=d(()=>i.accept!==void 0?i.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),N=d(()=>parseInt(i.maxFiles,10)),k=d(()=>parseInt(i.maxTotalSize,10));function j(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&Y(t);else{const v=h();v&&v!==t.target&&v.click(t)}}function I(t){e.value&&t&&b(null,t)}function D(t,v,S,C){let l=Array.from(v||t.target.files);const m=[],F=()=>{m.length>0&&s("rejected",m)};if(i.accept!==void 0&&y.value.indexOf("*/")===-1&&(l=_(l,m,"accept",n=>y.value.some(o=>n.type.toUpperCase().startsWith(o)||n.name.toUpperCase().endsWith(o))),l.length===0))return F();if(i.maxFileSize!==void 0){const n=parseInt(i.maxFileSize,10);if(l=_(l,m,"max-file-size",o=>o.size<=n),l.length===0)return F()}if(i.multiple!==!0&&l.length>0&&(l=[l[0]]),l.forEach(n=>{n.__key=n.webkitRelativePath+n.lastModified+n.name+n.size}),C===!0){const n=S.map(o=>o.__key);l=_(l,m,"duplicate",o=>n.includes(o.__key)===!1)}if(l.length===0)return F();if(i.maxTotalSize!==void 0){let n=C===!0?S.reduce((o,O)=>o+O.size,0):0;if(l=_(l,m,"max-total-size",o=>(n+=o.size,n<=k.value)),l.length===0)return F()}if(typeof i.filter=="function"){const n=i.filter(l);l=_(l,m,"filter",o=>n.includes(o))}if(i.maxFiles!==void 0){let n=C===!0?S.length:0;if(l=_(l,m,"max-files",()=>(n++,n<=N.value)),l.length===0)return F()}if(F(),l.length>0)return l}function Q(t){q(t),r.value!==!0&&(r.value=!0)}function u(t){L(t),(t.relatedTarget!==null||G.is.safari!==!0?t.relatedTarget!==f.value:document.elementsFromPoint(t.clientX,t.clientY).includes(f.value)===!1)===!0&&(r.value=!1)}function P(t){q(t);const v=t.dataTransfer.files;v.length>0&&b(null,v),r.value=!1}function T(t){if(r.value===!0)return x("div",{ref:f,class:`q-${t}__dnd absolute-full`,onDragenter:q,onDragover:q,onDragleave:u,onDrop:P})}return Object.assign(g,{pickFiles:j,addFiles:I}),{pickFiles:j,addFiles:I,onDragover:Q,onDragleave:u,processFiles:D,getDndNode:T,maxFilesNumber:N,maxTotalSizeNumber:k}}var Ce=H({name:"QFile",inheritAttrs:!1,props:{...J,...Z,...ye,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ee,..._e],setup(e,{slots:r,emit:h,attrs:b}){const{proxy:i}=$(),s=te(),g=z(null),f=z(!1),y=ae(e),{pickFiles:N,onDragover:k,onDragleave:j,processFiles:I,getDndNode:D}=Se({editable:s.editable,dnd:f,getFileInput:R,addFilesToQueue:w}),Q=le(e),u=d(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),P=d(()=>U(u.value)),T=d(()=>u.value.map(a=>a.name).join(", ")),t=d(()=>pe(u.value.reduce((a,c)=>a+c.size,0))),v=d(()=>({totalSize:t.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),S=d(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:y.value,...b,id:s.targetUid.value,disabled:s.editable.value!==!0})),C=d(()=>"q-file q-field--auto-height"+(f.value===!0?" q-file--dnd":"")),l=d(()=>e.multiple===!0&&e.append===!0);function m(a){const c=u.value.slice();c.splice(a,1),n(c)}function F(a){const c=u.value.findIndex(a);c>-1&&m(c)}function n(a){h("update:modelValue",e.multiple===!0?a:a[0])}function o(a){a.keyCode===13&&ue(a)}function O(a){(a.keyCode===13||a.keyCode===32)&&N(a)}function R(){return g.value}function w(a,c){const p=I(a,c,u.value,l.value),B=R();B!=null&&(B.value=""),p!==void 0&&((e.multiple===!0?e.modelValue&&p.every(X=>u.value.includes(X)):e.modelValue===p[0])||n(l.value===!0?u.value.concat(p):p))}function A(){return[x("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function W(){if(r.file!==void 0)return u.value.length===0?A():u.value.map((c,p)=>r.file({index:p,file:c,ref:this}));if(r.selected!==void 0)return u.value.length===0?A():r.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?A():u.value.map((c,p)=>x(ge,{key:"file-"+p,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{m(p)}},()=>x("span",{class:"ellipsis",textContent:c.name})));const a=e.displayValue!==void 0?e.displayValue:T.value;return a.length>0?[x("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:A()}function K(){const a={ref:g,...S.value,...Q.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:w};return e.multiple===!0&&(a.multiple=!0),x("input",a)}return Object.assign(s,{fieldClass:C,emitValue:n,hasValue:P,inputRef:g,innerValue:u,floatingLabel:d(()=>P.value===!0||U(e.displayValue)),computedCounter:d(()=>{if(e.counterLabel!==void 0)return e.counterLabel(v.value);const a=e.maxFiles;return`${u.value.length}${a!==void 0?" / "+a:""} (${t.value})`}),getControlChild:()=>D("file"),getControl:()=>{const a={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(a,{onDragover:k,onDragleave:j,onKeydown:o,onKeyup:O}),x("div",a,[K()].concat(W()))}}),Object.assign(i,{removeAtIndex:m,removeFile:F,getNativeElement:()=>g.value}),ne(i,"nativeEl",()=>g.value),ie(s)}});const Ve={class:"text-h5 row items-center q-mb-md"},ze=M("span",{class:"q-mr-md"},"Bilder",-1),Ee=re({__name:"ImagesPage",setup(e){const r=z(null),h=z(!1),b=ce(),i=()=>{const g=Fe();h.value=!0,xe(r.value,"images",g).then(f=>b.go(0)).catch(f=>console.error(f)).finally(()=>h.value=!1)},s=()=>{b.go(0)};return(g,f)=>(se(),oe(be,{class:"q-pa-md"},{default:E(()=>[M("div",Ve,[ze,de(),V(Ce,{modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=y=>r.value=y),class:"col",label:"V\xE4lj en bild att ladda upp",outlined:"",style:{"max-width":"300px"}},{append:E(()=>[V(fe,null,{default:E(()=>[V(me,{disable:r.value==null,icon:"upload",onClick:i},null,8,["disable"])]),_:1})]),_:1},8,["modelValue"])]),V(ve,{class:"q-mb-md"}),V(he,{onReload:s})]),_:1}))}});export{Ee as default};
